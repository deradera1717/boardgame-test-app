# 実装計画

- [x] 1. プロジェクト基盤とコアインターフェースの設定
  - Next.jsプロジェクトの初期設定（完了 - Next.js 14 + TypeScript設定済み）
  - 基本的なページ構造の作成（完了 - oshi-game ページ作成済み）
  - _要件: 1.1, 1.4_

- [x] 1.1 テストフレームワークとスタイリングの設定
  - テストフレームワーク（Jest + React Testing Library + fast-check）の設定
  - Tailwind CSS の導入（現在Material-UIを使用中）
  - _要件: 1.1_

- [x] 1.2 TypeScript型定義とコアインターフェースの作成
  - TypeScriptの型定義ファイル作成（GameSession, Player, GameState等）
  - React Context による状態管理の基盤構築
  - 推し活フェーズのサブステップ型定義の追加
  - グッズ価格定義の追加
  - _要件: 1.1, 1.4, 9.4_

- [x] 1.3 プロパティテスト: プレイヤー数制限の遵守
  - **プロパティ1: プレイヤー数制限の遵守**
  - **検証対象: 要件 1.2**

- [x] 2.1 プレイヤー名入力コンポーネントの実装
  - プレイヤー名入力フォームの作成（完了 - テスト用プレイヤー作成機能実装済み）
  - プレイヤー数制限（最大4人）の実装（完了 - バリデーション実装済み）
  - _要件: 1.1, 1.2_

- [x] 2.2 ゲームセッション管理の実装
  - ゲームセッション作成ロジックの実装（完了 - GameContext実装済み）
  - ゲーム開始条件の管理（完了 - initializeGame実装済み）
  - 初期リソース配布（オタクコマ4個、資金3金）（完了 - 実装済み）
  - _要件: 1.3, 1.5_

- [ ] 2.3 プロパティテスト: ゲーム開始条件の管理
  - **プロパティ2: ゲーム開始条件の管理**
  - **検証対象: 要件 1.3**

- [ ] 2.4 プロパティテスト: 初期リソース配布の一貫性
  - **プロパティ3: 初期リソース配布の一貫性**
  - **検証対象: 要件 1.5**

- [x] 3. ゲームボードとコンポーネント表示
  - 花道ボード（2×4グリッド）コンポーネントの実装
  - オタクコマとグッズチップの表示コンポーネント
  - 推しコマ（A、B、C）の表示機能
  - ドラッグ&ドロップ操作の基本実装
  - _要件: 1.4, 8.1_

- [x] 4. ターン管理とフェーズ制御システム
  - ターン管理ロジックの実装
  - フェーズ遷移システムの構築
  - アクティブプレイヤーの表示とハイライト
  - フェーズ表示とアクション待ち状況の管理
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 4.1 プロパティテスト: ターン順序の循環性
  - **プロパティ4: ターン順序の循環性**
  - **検証対象: 要件 2.2**

- [x] 4.2 プロパティテスト: フェーズ遷移の整合性
  - **プロパティ5: フェーズ遷移の整合性**
  - **検証対象: 要件 2.3**

- [x] 4.3 プロパティテスト: アクション完了状態の追跡
  - **プロパティ6: アクション完了状態の追跡**
  - **検証対象: 要件 2.4, 2.5**

- [x] 5. 労働フェーズの実装
  - 報酬配分カード（A-F）を場に並べる表示機能
  - スタートプレイヤーから順番に1枚ずつ選択する機能
  - サイコロ1回振りの実装
  - 出た目の数字に対応する報酬計算ロジック
  - 資金配布と所持金更新機能
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 5.1 プロパティテスト: 報酬計算と資金更新の一貫性
  - **プロパティ7: 報酬計算と資金更新の一貫性**
  - **検証対象: 要件 3.4, 3.5**
  - PBT_STATUS: passed

- [x] 6. 推しかつ決断フェーズの実装
  - 同時選択UI（「推しかつする」「休む」）の実装
  - 全員同時に「せーの」で宣言する機能
  - 秘匿選択の管理システム
  - 全員選択完了時の同時公開機能
  - 「休む」選択時の追加報酬処理とラウンドお休み機能
  - 推し活フェーズ参加者の管理
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 6.1 プロパティテスト: 秘匿選択の管理
  - **プロパティ8: 秘匿選択の管理**
  - **検証対象: 要件 4.2, 4.3**

- [x] 6.2 プロパティテスト: 休む選択時の追加報酬
  - **プロパティ9: 休む選択時の追加報酬**
  - **検証対象: 要件 4.4**

- [x] 7. 推し活フェーズ - ファンサスポットカード公開ステップ
  - 14枚のファンサスポット予測カード管理システム
  - 裏表ランダムで3枚選択する機能
  - カードの向き（表・裏）と上下のランダム決定
  - ファンサスポットカード表示コンポーネント
  - _要件: 5.1, 5.2, 10.1_

- [x] 7.1 プロパティテスト: ファンサスポットカードのランダム生成
  - **プロパティ10: ファンサスポットカードのランダム生成**
  - **検証対象: 要件 5.1, 5.2**
  - PBT_STATUS: passed

- [x] 7.2 プロパティテスト: ファンサスポット組み合わせの完全性
  - **プロパティ16: ファンサスポット組み合わせの完全性**
  - **検証対象: 要件 9.1**
  - PBT_STATUS: passed

- [x] 8. 推し活フェーズ - グッズ購入ステップ
  - スタートプレイヤーから順番にグッズ購入する機能
  - グッズ価格設定（うちわ・ペンライト・差し入れ: 2金、影分身: 3金）
  - 資金消費とグッズチップ付与ロジック
  - 買える分だけ購入できる機能
  - _要件: 5.3, 5.4_

- [x] 8.5 推し活フェーズ - 待機（オタクコマ配置）ステップ
  - スタートプレイヤーから順番にオタクコマを1つずつ配置する機能（1人最大4つまで）
  - オタクコマ配置機能（ドラッグ&ドロップ）
  - 配置制限（1スポット最大3個）の実装
  - 通常オタクコマ配置完了後の影分身コマ配置機能
  - グッズチップをオタクコマの上に配置する機能（1オタクコマに1つまで）
  - _要件: 5.5, 5.6, 5.7, 5.8, 8.1_

- [x] 8.1 プロパティテスト: グッズ購入処理の整合性
  - **プロパティ11: グッズ購入処理の整合性**
  - **検証対象: 要件 5.3**
  - PBT_STATUS: passed

- [x] 8.2 プロパティテスト: オタクコマ配置制限の適用
  - **プロパティ12: オタクコマ配置制限の適用**
  - **検証対象: 要件 5.5**
  - PBT_STATUS: passed

- [x] 9. チェックポイント - 基本機能テスト
  - 全てのテストが通ることを確認し、ユーザーに質問があれば尋ねる

- [x] 10. ファンサタイムとポイント計算システム
  - 各推し（A、B、C）のファンサスポットをサイコロ1回振りで決定
  - 1,2→スポット1、3,4→スポット2、5,6→スポット3のルール適用
  - 推しコマの配置と表示更新
  - 基本ポイント計算（目の前6ポイント山分け）
  - 特殊ポイント計算（うちわ隣接、ペンライト向かい側、差し入れ倍化）
  - 山分け計算の端数処理
  - 各推し（A、B、C）のファンサ計算完了後のポイント換算
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 10.2, 10.3_

- [x] 10.1 プロパティテスト: 包括的ポイント計算システム
  - **プロパティ13: 包括的ポイント計算システム**
  - **検証対象: 要件 6.2, 6.3, 6.4, 6.5**
  - PBT_STATUS: passed

- [x] 10.2 プロパティテスト: サイコロマッピングルールの適用
  - **プロパティ14: サイコロマッピングルールの適用**
  - **検証対象: 要件 9.2**
  - PBT_STATUS: passed

- [x] 10.3 プロパティテスト: 山分け計算の端数処理
  - **プロパティ15: 山分け計算の端数処理**
  - **検証対象: 要件 9.3**
  - PBT_STATUS: passed

- [x] 11. ゲーム進行とラウンド管理
  - ラウンド進行ロジック（労働→推し活決断→推し活→ファンサタイム→ポイント計算）の実装
  - フェーズ1-3完了後の次フェーズ開始機能
  - ラウンド完了時のスタートプレイヤー移動機能
  - ゲーム終了条件（8ラウンド）の管理
  - 最終スコア計算と勝者決定
  - ゲーム結果表示画面
  - _要件: 1.4, 6.8, 9.1, 9.2, 9.3_

- [x] 12. データ永続化とログ記録システム
  - ゲーム状態のJSON シリアライゼーション
  - ローカルストレージへの保存機能
  - ゲーム履歴とログ記録システム
  - データ分析用の統計出力機能
  - _要件: 7.1, 7.2, 7.3, 7.4, 7.5, 9.4, 9.5_

- [x] 12.1 プロパティテスト: ゲーム状態のラウンドトリップ一貫性
  - **プロパティ17: ゲーム状態のラウンドトリップ一貫性**
  - **検証対象: 要件 9.4, 9.5**

- [x] 12.2 プロパティテスト: 包括的ログ記録システム
  - **プロパティ18: 包括的ログ記録システム**
  - **検証対象: 要件 7.1, 7.2, 7.3**

- [x] 13. エラーハンドリングとバリデーション
  - 無効操作の検出と処理
  - エラーメッセージ表示システム
  - ゲーム状態の整合性チェック
  - 回復機能の実装
  - _要件: 8.3_

- [x] 13.1 プロパティテスト: 無効操作の検出と処理
  - **プロパティ19: 無効操作の検出と処理**
  - **検証対象: 要件 8.3**
  - PBT_STATUS: passed

- [ ] 13.2 プロパティテスト: ラウンドフェーズ進行の順序性
  - **プロパティ20: ラウンドフェーズ進行の順序性**
  - **検証対象: 要件 9.1, 9.2**

- [ ] 13.3 プロパティテスト: 推し活フェーズのサブステップ順序性
  - **プロパティ21: 推し活フェーズのサブステップ順序性**
  - **検証対象: 要件 9.4**

- [ ] 13.4 プロパティテスト: グッズ持ち越し制限の適用
  - **プロパティ22: グッズ持ち越し制限の適用**
  - **検証対象: 要件 9.5**

- [ ] 13.5 プロパティテスト: オタクコマ配置順序の管理
  - **プロパティ23: オタクコマ配置順序の管理**
  - **検証対象: 要件 5.5, 5.7**

- [x] 14. UI/UX の改善と最適化
  - アニメーション効果の追加
  - レスポンシブデザインの実装
  - アクセシビリティの向上
  - パフォーマンス最適化
  - _要件: 8.2, 8.4, 8.5_

- [x] 15. 最終チェックポイント - 全機能統合テスト
  - 全てのテストが通ることを確認し、ユーザーに質問があれば尋ねる
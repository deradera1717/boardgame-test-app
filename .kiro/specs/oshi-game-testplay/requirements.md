# 要件定義書

## 概要

推し活をテーマにしたボードゲームのテストプレイを行うためのWEBアプリケーション。プレイヤーは推しのファンサスポットを予測し、オタクコマを配置してポイントを競う。ゲームバランスの調整とルールの検証を目的とする。

## 用語集

- **System**: 推し活ボードゲームテストプレイシステム
- **Player**: ゲームに参加するプレイヤー（最大4人）
- **Hanamichi_Board**: 花道ボード（2列×4行の8マス）
- **Oshi_Piece**: 推しコマ（A、B、C の3体）
- **Otaku_Piece**: オタクコマ（プレイヤーごとに4個）
- **Fanservice_Spot_Card**: ファンサスポットカード（28通りの組み合わせ）
- **Goods_Chip**: グッズチップ（うちわ、ペンライト、差し入れ）
- **Reward_Distribution_Card**: 報酬配分カード（サイコロの出目ごとの報酬設定）
- **Round**: ラウンド（労働→推しかつ決断→推し活の一連の流れ）

## 要件

### 要件1

**ユーザーストーリー:** プレイヤーとして、ゲームを開始する前に参加者を設定したいので、プレイヤー名を入力してゲームセッションを作成したい。

#### 受入基準

1. WHEN システムが起動される THEN System SHALL プレイヤー名入力画面を表示する
2. WHEN プレイヤーが名前を入力する THEN System SHALL 最大4人までの参加者を受け付ける
3. WHEN 全プレイヤーの名前が入力される THEN System SHALL ゲーム開始ボタンを有効化する
4. WHEN ゲームが開始される THEN System SHALL 花道ボード（2列×4行の8マス）を表示する
5. WHEN ゲームが開始される THEN System SHALL 各プレイヤーに4個のオタクコマと初期資金3金を配布する

### 要件2

**ユーザーストーリー:** プレイヤーとして、ゲーム中に現在の状況を把握したいので、誰のターンなのかと各プレイヤーの状態を明確に表示したい。

#### 受入基準

1. WHEN ゲームが進行中である THEN System SHALL 現在のアクティブプレイヤーを視覚的にハイライト表示する
2. WHEN プレイヤーのターンが変わる THEN System SHALL ターン表示を更新し次のプレイヤーを明示する
3. WHEN 各フェーズが進行する THEN System SHALL 現在のフェーズ名とアクション待ちプレイヤーを表示する
4. WHEN プレイヤーがアクションを完了する THEN System SHALL 完了状態を他プレイヤーに表示する
5. WHEN 全プレイヤーが同時アクションを行う場合 THEN System SHALL 各プレイヤーの選択完了状況を表示する

### 要件3

**ユーザーストーリー:** プレイヤーとして、労働フェーズで資金を獲得したいので、報酬配分カードを選択してサイコロの結果に応じた報酬を得たい。

#### 受入基準

1. WHEN 労働フェーズが開始される THEN System SHALL 6種類の報酬配分カードを場に並べて表示する
2. WHEN プレイヤーが報酬配分カードを選択する THEN System SHALL スタートプレイヤーから順番に1枚ずつ選択させる
3. WHEN 全プレイヤーがカードを選択完了する THEN System SHALL サイコロを1回振り結果を表示する
4. WHEN サイコロの結果が確定する THEN System SHALL 出た目の数字に対応する報酬を各プレイヤーの選択カードに基づいて配布する
5. WHEN 資金配布が完了する THEN System SHALL 各プレイヤーの所持金を更新表示する

### 要件4

**ユーザーストーリー:** プレイヤーとして、推しかつするかどうかを決めたいので、同時に宣言して選択肢を選べるようにしたい。

#### 受入基準

1. WHEN 推しかつ決断フェーズが開始される THEN System SHALL 全プレイヤーに「推しかつする」「休む」の選択肢を提示する
2. WHEN プレイヤーが選択を行う THEN System SHALL 全員同時に「せーの」で宣言させ選択内容を隠して記録する
3. WHEN 全プレイヤーが選択完了する THEN System SHALL 全員の選択を同時に公開する
4. WHEN プレイヤーが「休む」を選択する THEN System SHALL 労働フェーズで得た資金と同額を追加付与しこのラウンドをお休みにする
5. WHEN プレイヤーが「推しかつする」を選択する THEN System SHALL そのプレイヤーを続く推し活フェーズに参加させる

### 要件5

**ユーザーストーリー:** プレイヤーとして、推し活フェーズで戦略的にプレイしたいので、3つのステップ（カード公開、グッズ購入、待機）を順番に実行したい。

#### 受入基準

1. WHEN 推し活フェーズが開始される THEN System SHALL 14枚のファンサスポット予測カードから裏表ランダムで3枚を公開する
2. WHEN ファンサスポットカードが公開される THEN System SHALL カードの向き（表・裏）と上下をランダムに選択する
3. WHEN グッズ購入ステップが開始される THEN System SHALL スタートプレイヤーから順番にグッズ購入を行わせる
4. WHEN プレイヤーがグッズを購入する THEN System SHALL うちわ・ペンライト・差し入れは2金、影分身は3金で販売する
5. WHEN 待機ステップが開始される THEN System SHALL スタートプレイヤーから順番にオタクコマを1つずつ配置させる（1人最大4つまで）
6. WHEN 1つのスポットに3つのオタクコマが配置される THEN System SHALL それ以上の配置を制限する
7. WHEN 通常のオタクコマ配置が終了する THEN System SHALL 影分身を持つプレイヤーに影分身コマを順番に配置させる
8. WHEN オタクコマ配置が完了する THEN System SHALL プレイヤーに持っているグッズを好きなオタクコマの上に乗せさせる（1オタクコマに1つまで）

### 要件6

**ユーザーストーリー:** プレイヤーとして、ファンサタイムでポイントを獲得したいので、推しの停止位置とオタクコマの配置に基づいてポイント計算をしたい。

#### 受入基準

1. WHEN ファンサタイムが開始される THEN System SHALL 各推し（A、B、C）のファンサスポットをサイコロ1回振りで決定する
2. WHEN サイコロを振る THEN System SHALL 1,2→スポット1、3,4→スポット2、5,6→スポット3のルールを適用する
3. WHEN 推しがオタクコマの目の前に停止する THEN System SHALL そのマスのオタクコマで6ポイントを山分けする
4. WHEN うちわを持つオタクコマの隣に推しが停止する THEN System SHALL そのオタクコマに1ポイントを付与する
5. WHEN ペンライトを持つオタクコマの向かい側に推しが停止する THEN System SHALL そのオタクコマに1ポイントを付与する
6. WHEN 差し入れを持つオタクコマの目の前に推しが停止する THEN System SHALL そのオタクコマのポイントを2倍にする
7. WHEN 各推し（A、B、C）のファンサ計算が完了する THEN System SHALL ポイントを換算しラウンドを終了する
8. WHEN ラウンドが終了する THEN System SHALL スタートプレイヤーを次のプレイヤーに移す

### 要件7

**ユーザーストーリー:** ゲーム開発者として、ゲームデータを分析したいので、各ラウンドの詳細な記録とプレイ統計を取得したい。

#### 受入基準

1. WHEN ゲームが進行する THEN System SHALL 全ての選択と結果をログとして記録する
2. WHEN ラウンドが終了する THEN System SHALL ポイント獲得の詳細を記録する
3. WHEN ゲームが終了する THEN System SHALL プレイ時間と各プレイヤーの行動履歴を保存する
4. WHEN 管理者がデータを要求する THEN System SHALL ゲーム統計をJSON形式で出力する
5. WHEN 複数ゲームのデータが蓄積される THEN System SHALL 集計データとバランス分析を提供する

### 要件8

**ユーザーストーリー:** プレイヤーとして、直感的にゲームを操作したいので、分かりやすいUIでドラッグ&ドロップやクリック操作ができるようにしたい。

#### 受入基準

1. WHEN プレイヤーがオタクコマを配置する THEN System SHALL ドラッグ&ドロップ操作を受け付ける
2. WHEN プレイヤーがグッズチップを配置する THEN System SHALL オタクコマ上への配置をビジュアルで確認できる
3. WHEN 無効な操作が行われる THEN System SHALL エラーメッセージを表示し操作を無効化する
4. WHEN ゲーム状態が変化する THEN System SHALL アニメーションで変化を視覚的に表現する
5. WHEN プレイヤーが操作を待機中である THEN System SHALL 現在のフェーズと待機状況を明確に表示する

### 要件9

**ユーザーストーリー:** プレイヤーとして、ラウンドの進行を理解したいので、明確な順序でフェーズが進行するようにしたい。

#### 受入基準

1. WHEN ラウンドが開始される THEN System SHALL 労働フェーズ→推し活の決断→推し活フェーズ→ファンサタイム→ポイント計算の順番で進行する
2. WHEN フェーズ1-3が終了する THEN System SHALL 次のフェーズを開始する
3. WHEN ラウンドが完了する THEN System SHALL スタートプレイヤーを次のプレイヤーに移す
4. WHEN 推し活フェーズが開始される THEN System SHALL ファンサスポット予測カード公開→グッズ購入→待機の3ステップで進行する
5. WHEN 資金が繰り越される THEN System SHALL グッズは持ち越さずに処理する

### 要件10

**ユーザーストーリー:** 開発者として、ゲームルールを正確に実装したいので、ファンサスポットカードの組み合わせ生成とサイコロ判定を正しく処理したい。

#### 受入基準

1. WHEN ファンサスポットカードを生成する THEN System SHALL 8マス中3マスの全28通りの組み合わせを管理する
2. WHEN サイコロでファンサスポットを決定する THEN System SHALL 1-2→スポット1、3-4→スポット2、5-6→スポット3のルールを適用する
3. WHEN ポイント計算を実行する THEN System SHALL 山分け計算で端数を適切に処理する
4. WHEN ゲーム状態を保存する THEN System SHALL JSON形式でシリアライズ可能な形式で管理する
5. WHEN ゲーム状態を復元する THEN System SHALL 保存されたデータから正確にゲーム状態を再構築する